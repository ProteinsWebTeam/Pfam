
[%
# phylo.tt
# jt6 20060515 WTSI
#
# block showing the phylogenetic tree for a family
#
# $Id: phylo.tt,v 1.20 2008-05-22 10:24:28 jt6 Exp $

treeUri = c.uri_for( "/family/tree" );
%]

<!-- start of phyloBlock -->

<div class="block" id="phyloBlock">
  <div class="handle">
    <h1>Trees</h1>
  </div>
  <div class="blockContent">
    <p>
      This page displays the 
      <acronym title="Unweighted Pair Group Method with Arithmetic mean">UPGMA</acronym>-based 
      phylogenetic tree, generated using 
      <a class="ext" href="http://www.sanger.ac.uk/Software/analysis/quicktree/">
        quicktree</a> for the given alignment.
    </p> 
    [% # the form that controls the tree display %]
    <form id="phyloForm"
          action="[% treeUri %]">
      <div>
        <span>
          <input id="seedRb" 
                 name="type"
                 type="radio" 
                 checked="checked" 
                 value="seed" />
          <label for="seedRb">Seed ([% pfam.num_seed %])</label>
        </span>
        <span>
          <input id="fullRb" 
                 name="type"
                 type="radio" 
                 value="full" />
          <label for="fullRb">Full ([% pfam.num_full %])</label>
        </span>
        <span>
          <input id="ncbiRb" 
                 name="type"
                 type="radio" 
                 value="ncbi" />
          <label for="ncbiRb">NCBI</label>
        </span>
        <input type="button"
               onclick="treeSubmitter();"
               value="Change tree" />
      </div>
    </form>

    <div id="alignmentTree">
      <p id="atph" class="loading">
          Loading alignment tree...
        </p>  
    </div>

    <script type="text/javascript">
      // <![CDATA[
      // set the options for the ajax call that populates the tree the first time
      loadOptions.at.uri    = "[% treeUri %]";
      loadOptions.at.params = { acc: "[% acc %]" };

      // a function that submits subsequent requests 
      treeSubmitter = function() {
        var checkedId =  ['seedRb','fullRb','ncbiRb'].find(
            function( buttonId ) {
              return $(buttonId).checked;
            }
          );
        var type = $(checkedId).value;
        var u = new Ajax.Updater( 'alignmentTree', 
                          '[% treeUri %]', 
                          { method:     'get',
                            parameters: { acc:     '[% acc %]',
                                          alnType: type } 
                          } );
        return false;
      };
      // ]]>
    </script>

    <p>
      <strong>Note:</strong> You can also download the data files for the
      <a href="[% c.uri_for( "/family/tree/download", { alnType = "seed", acc = acc } ) | html %]">seed</a>,
      <a href="[% c.uri_for( "/family/tree/download", { alnType = "full", acc = acc } ) | html %]">full</a> or
      <a href="[% c.uri_for( "/family/tree/download", { alnType = "ncbi", acc = acc } ) | html %]">ncbi</a>
      trees.
    </p>

  </div>
</div>

<!-- end of phyloBlock -->
[%#
Copyright (c) 2007: Genome Research Ltd.

Authors: Rob Finn (rdf@sanger.ac.uk), John Tate (jt6@sanger.ac.uk)

This is free software; you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free Software
Foundation; either version 2 of the License, or (at your option) any later
version.

This program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
details.

You should have received a copy of the GNU General Public License along with
this program. If not, see <http://www.gnu.org/licenses/>.
-%]
